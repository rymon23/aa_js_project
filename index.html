<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="stylesheet" href="./src/styles/index.css">
    <title>Fitness Dash</title>
    <style>
        * { padding: 0; margin: 0;}
        canvas {background: rgb(191, 193, 189); display: block; margin: 0 auto;}
    </style>
</head>
<body>
    <!-- <div id="root">you should not see this</div> -->
    <canvas id="canvas-id" width="1080" height="720"></canvas>
<script>
    const canvas = document.getElementById("canvas-id");
    const ctx = canvas.getContext("2d");

    const GAME_SCREEN = [1080, 720];
    const wallBuffer = 75;
    const wallWidth = 50;

    const bricks = [];


    const setUpRoundColumns = (startPosX = 125) => {
        const randomColumnBuffer = () => {
            return getRandomInt(40, 80)
        }
        const wallStartPos = (length) => {
            if (Math.random() >= 0.5) { return 0 }
            return GAME_SCREEN[1] - length
        }    

        let currentPosX = startPosX;
        let ix = 0;

        while (currentPosX < GAME_SCREEN[0] * 0.85) {
            let length = getRandomInt(50, GAME_SCREEN[1] * 0.8);
            bricks[ix] = { 
                height: length,
                x: currentPosX,
                y: wallStartPos(length)
                // widthBuffer: currentPosX, 
                // length: length,
                // verticalStart: wallStartPos(length),
            }
            ix += 1;
            currentPosX += wallWidth + randomColumnBuffer();
        }
    }
            


    function getRandomInt(min, max) {
        min = Math.ceil(min);
        max = Math.floor(max);
        return Math.floor(Math.random() * (max - min)) + min;
    }

    const generateSingleWall = (wallBuffer) => {
        const wallStartPos = (length) => {
            if (Math.random() >= 0.5){ return 0}
            return GAME_SCREEN[1] - length
        }        
        const length = getRandomInt(50, GAME_SCREEN[1]*0.8);
        ctx.beginPath();
        ctx.rect(wallBuffer, wallStartPos(length), wallWidth, length);
        ctx.fillStyle = "#FFFFF";
        ctx.fill();
        ctx.closePath();
    }

    const generateBrokenWall = (wallBuffer) => {
        const gap = getRandomInt(55, 95);
        const topLength = getRandomInt(50, GAME_SCREEN[1]*0.6);
        ctx.beginPath();
        ctx.rect(wallBuffer, 0, wallWidth, topLength);
        ctx.rect(wallBuffer, topLength + gap, wallWidth, GAME_SCREEN[1] - (topLength + gap));
        ctx.fillStyle = "#FFFFF";
        ctx.fill();
        ctx.closePath();
    }

    const generateColumns = (startPos = 125) => {
         const randomColumnBuffer = () => {
            return getRandomInt(40, 80)
        }
        const generateRandomColumn = (currentColumnPos) => {
            if (Math.random() >= 0.5) { 
                generateSingleWall(currentColumnPos) 
            }else { generateBrokenWall(currentColumnPos)}
        }

        let currentColumnPos = startPos;
        while(currentColumnPos < GAME_SCREEN[0]*0.85){
            generateRandomColumn(currentColumnPos);
            currentColumnPos += randomColumnBuffer();
        }
    }


    let x = canvas.width / 2;
    let y = canvas.height - 30;
    let dx = 5;
    let dy = -5;
    const ballRadius = 10;

    const boxY = (canvas.height / 2) / 2;

    const startBox = {
        height: canvas.height / 2,
        width: 60,
        x: 0,
        y: boxY,
        strokeStyle: "rgba(0, 0, 255, 0.5)",
    };
    const finishBox = {
        height: canvas.height / 2,
        width: 60,
        x: canvas.width - 60,
        y: boxY,
        strokeStyle: "rgba(0, 0, 255, 0.5)",
    };

    const drawBox = (box) => {
        ctx.beginPath();
        ctx.rect(box.x, box.y, box.width, box.height);
        ctx.strokeStyle = box.strokeStyle;
        ctx.stroke();
        ctx.closePath();
    };

    // function drawFinishBox() {
    //     const height = canvas.height / 2
    //     const x = canvas.width - 60;
    //     const y = (canvas.height - height) / 2;
    //     ctx.beginPath();
    //     ctx.rect(x, y, 60, height);
    //     ctx.strokeStyle = "rgba(0, 0, 255, 0.5)";
    //     ctx.stroke();
    //     ctx.closePath();
    // }

    function drawBall() {
        ctx.beginPath();
        ctx.arc(x, y, ballRadius, 0, Math.PI * 2);
        ctx.fillStyle = "#0095DD";
        ctx.fill();
        ctx.closePath();
    }
    const drawColumns = () => {
        for (let i = 0; i < bricks.length; i++) {
            const brick = bricks[i];
            ctx.beginPath();
            // ctx.rect(brick.widthBuffer, brick.verticalStart, wallWidth, brick.length);
            ctx.rect(brick.x, brick.y, wallWidth, brick.height);
            ctx.fillStyle = "#FFFFF";
            ctx.fill();
            ctx.closePath();
        }
    }

    function columnCollisionDetection() {
        for (let i = 0; i < bricks.length; i++) {
            const brick = bricks[i];
            //testing only
            ctx.beginPath();
            ctx.rect(brick.x, brick.y, wallWidth, brick.height);
            ctx.fillStyle = "#ff0000";
            ctx.fill();
            ctx.closePath();

    
            if (x > brick.x - ballRadius && x - ballRadius < brick.x + wallWidth && y > brick.y && y < brick.y + brick.height) {
                dx = -dx;
            }
            if (x > brick.x && x < brick.x + wallWidth && (y > brick.y - ballRadius && y - ballRadius < brick.y + brick.height) ) {
                dy = -dy;
            }

        }
    }

    const draw = () =>{
        // debugger
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        drawColumns();
        drawBox(startBox);
        drawBox(finishBox);
        drawBall();
        columnCollisionDetection();

        if (x + dx > canvas.width - ballRadius || x + dx < ballRadius) {
            dx = -dx;
        }
        if (y + dy > canvas.height - ballRadius || y + dy < ballRadius) {
            dy = -dy;
        }

        x += dx;
        y += dy;
    }

    const runGame = () => {
        setInterval(draw, 10);
    }

    setUpRoundColumns()
    runGame();
</script>

</body>
</html>